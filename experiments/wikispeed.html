<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Wikipedia Speed Run Yay</title>
    <style>
      :root {
        --bg-color: #f4f4f0;
        --accent: #ff4757;
        --text: #2f3542;
        --border: 3px solid #2f3542;
        --shadow: 4px 4px 0px #2f3542;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Courier New", Courier, monospace; /* Retro vibe */
        background: var(--bg-color);
        color: var(--text);
        line-height: 1.6;
        padding-bottom: 2rem;
      }

      /* --- Layout --- */
      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 1rem;
      }

      header {
        text-align: center;
        margin-bottom: 2rem;
        padding: 2rem;
        background: white;
        border: var(--border);
        box-shadow: var(--shadow);
      }

      h1 {
        font-size: 2.5rem;
        font-weight: 900;
        text-transform: uppercase;
        letter-spacing: -1px;
        margin-bottom: 0.5rem;
      }

      .game-layout {
        display: grid;
        grid-template-columns: 300px 1fr;
        gap: 1.5rem;
        align-items: start;
      }

      /* --- Sidebar --- */
      .sidebar {
        background: white;
        border: var(--border);
        box-shadow: var(--shadow);
        padding: 1.5rem;
        position: sticky;
        top: 1rem;
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
      }

      .target-box {
        background: var(--accent);
        color: white;
        padding: 1rem;
        border: var(--border);
        text-align: center;
      }

      .target-label {
        font-size: 0.8rem;
        text-transform: uppercase;
        font-weight: bold;
        opacity: 0.9;
      }

      .target-title {
        font-size: 1.4rem;
        font-weight: 900;
        line-height: 1.2;
        margin-top: 0.5rem;
      }

      .target-desc {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        font-size: 0.85rem;
        margin-top: 0.5rem;
        opacity: 0.9;
        font-style: italic;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
      }

      .stat-item {
        text-align: center;
      }
      .stat-val {
        font-size: 2rem;
        font-weight: 900;
      }
      .stat-lbl {
        font-size: 0.7rem;
        text-transform: uppercase;
        font-weight: bold;
        color: #777;
      }

      /* --- Content Area --- */
      .game-board {
        background: white;
        border: var(--border);
        box-shadow: var(--shadow);
        min-height: 80vh;
        display: flex;
        flex-direction: column;
      }

      .breadcrumbs {
        padding: 1rem;
        background: #eee;
        border-bottom: var(--border);
        font-size: 0.85rem;
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        align-items: center;
      }

      .crumb {
        color: #666;
      }
      .crumb:last-child {
        color: var(--accent);
        font-weight: bold;
      }
      .crumb::after {
        content: "→";
        margin-left: 0.5rem;
        color: #ccc;
      }
      .crumb:last-child::after {
        display: none;
      }

      .wiki-content {
        padding: 2rem;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        font-size: 1.1rem;
        overflow-x: hidden;
      }

      /* Wikipedia Specific Overrides to make it readable/playable */
      .wiki-content h1 {
        font-size: 2rem;
        margin-bottom: 1rem;
        border-bottom: 2px solid #eee;
        padding-bottom: 0.5rem;
      }
      .wiki-content h2 {
        font-size: 1.5rem;
        margin-top: 2rem;
        margin-bottom: 1rem;
        font-weight: bold;
        border-bottom: 1px solid #eee;
      }
      .wiki-content p {
        margin-bottom: 1rem;
      }
      .wiki-content ul {
        padding-left: 2rem;
        margin-bottom: 1rem;
      }
      .wiki-content a {
        color: #2980b9;
        text-decoration: none;
        font-weight: 500;
      }
      .wiki-content a:hover {
        text-decoration: underline;
        background: #e8f4fc;
      }
      .wiki-content .mw-empty-elt {
        display: none;
      }
      /* Hide clutter */
      .wiki-content .infobox,
      .wiki-content .sidebar,
      .wiki-content .thumb,
      .wiki-content .reference,
      .wiki-content .hatnote,
      .wiki-content .ambox,
      .wiki-content .reflist,
      .wiki-content table {
        display: none !important;
      }

      /* --- Buttons --- */
      button {
        background: var(--text);
        color: white;
        border: none;
        padding: 1rem 2rem;
        font-family: inherit;
        font-weight: 900;
        font-size: 1rem;
        cursor: pointer;
        border: 3px solid transparent;
        transition: all 0.2s;
        text-transform: uppercase;
      }
      button:hover {
        background: white;
        color: var(--text);
        border: var(--border);
        transform: translate(-2px, -2px);
        box-shadow: 4px 4px 0px rgba(0, 0, 0, 0.2);
      }
      button.secondary {
        background: #ddd;
        color: var(--text);
      }
      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      /* --- Modal --- */
      .modal-overlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.8);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      }
      .modal {
        background: white;
        padding: 3rem;
        max-width: 600px;
        width: 90%;
        border: var(--border);
        box-shadow: 10px 10px 0px rgba(255, 255, 255, 0.2);
        text-align: center;
      }
      .modal h2 {
        color: var(--accent);
        font-size: 3rem;
        margin-bottom: 1rem;
      }

      .leaderboard-section {
        margin-top: 2rem;
        border-top: 2px solid #eee;
        padding-top: 2rem;
      }

      .lb-row {
        display: flex;
        justify-content: space-between;
        padding: 0.5rem;
        border-bottom: 1px solid #eee;
        font-family: -apple-system, sans-serif;
      }
      .lb-row.header {
        font-weight: bold;
        text-transform: uppercase;
        color: #888;
        font-size: 0.8rem;
      }

      /* Utility */
      .hidden {
        display: none !important;
      }
      .loading-spinner {
        font-size: 1.5rem;
        color: #888;
        text-align: center;
        padding: 3rem;
        animation: pulse 1s infinite;
      }
      @keyframes pulse {
        0% {
          opacity: 0.5;
        }
        100% {
          opacity: 1;
        }
      }

      @media (max-width: 900px) {
        .game-layout {
          grid-template-columns: 1fr;
        }
        .sidebar {
          position: static;
          margin-bottom: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header id="menuScreen">
        <h1>Wiki Speed Run</h1>
        <p style="margin-bottom: 2rem; color: #666">
          Navigate from A to B using only internal links.
        </p>

        <div class="controls">
          <button id="startBtn">Start Game</button>
        </div>

        <div class="leaderboard-section">
          <h3>Your Personal Bests (Local)</h3>
          <div
            id="localStats"
            style="margin-top: 1rem; font-style: italic; color: #888"
          >
            No games played yet.
          </div>
        </div>

        <div class="leaderboard-section">
          <h3>Global Leaderboard</h3>
          <div id="leaderboardList" style="margin-top: 1rem">Loading...</div>
        </div>
      </header>

      <div id="gameScreen" class="game-layout hidden">
        <aside class="sidebar">
          <div class="target-box">
            <div class="target-label">Target Page</div>
            <div class="target-title" id="targetDisplay">?</div>
            <div class="target-desc" id="targetDesc">
              Loading description...
            </div>
          </div>

          <div class="stats-grid">
            <div class="stat-item">
              <div class="stat-val" id="clickCount">0</div>
              <div class="stat-lbl">Clicks</div>
            </div>
            <div class="stat-item">
              <div class="stat-val" id="timerDisplay">0:00</div>
              <div class="stat-lbl">Time</div>
            </div>
          </div>

          <button class="secondary" id="giveUpBtn">Give Up</button>
        </aside>

        <main class="game-board">
          <div class="breadcrumbs" id="breadcrumbs"></div>
          <div class="wiki-content" id="wikiContent"></div>
        </main>
      </div>
    </div>

    <div class="modal-overlay" id="winModal">
      <div class="modal">
        <h2>VICTORY!</h2>
        <p>
          You reached <strong><span id="winTargetName"></span></strong>
        </p>

        <div class="stats-grid" style="margin: 2rem 0">
          <div class="stat-item">
            <div class="stat-val" id="winClicks">0</div>
            <div class="stat-lbl">Clicks</div>
          </div>
          <div class="stat-item">
            <div class="stat-val" id="winTime">0:00</div>
            <div class="stat-lbl">Time</div>
          </div>
        </div>

        <input
          type="text"
          id="playerName"
          placeholder="Enter Name for Leaderboard"
          style="
            padding: 1rem;
            border: var(--border);
            width: 100%;
            margin-bottom: 1rem;
            font-size: 1.1rem;
          "
        />
        <button id="submitScoreBtn">Submit Score</button>
        <button class="secondary" id="playAgainBtn" style="margin-top: 0.5rem">
          Play Again
        </button>
      </div>
    </div>

    <script>
      // --- CONFIGURATION ---
      // Replace this URL with your Google Apps Script Web App URL if you have one.
      // If left as is, the game works perfectly but global leaderboard submission will fail gracefully.
      const APPS_SCRIPT_URL =
        "https://script.google.com/macros/s/AKfycbxJLd1l2RWakcrO0Txnjo65Cp4Bqp2RKe84R7bAwESuTvDTeDrMxF4mNXveKBUc108G/exec";

      // --- DATA POOLS ---
      const startingPoints = [
        "Acorn",
        "Alarm_clock",
        "Anchor",
        "Anvil",
        "Apple",
        "Apron",
        "Armchair",
        "Arrow",
        "Axe",
        "Baby_bottle",
        "Backpack",
        "Balloon",
        "Banana",
        "Bandage",
        "Banjo",
        "Barbed_wire",
        "Basket",
        "Basketball",
        "Bathtub",
        "Battery_(electricity)",
        "Bed",
        "Bell",
        "Belt_(clothing)",
        "Bicycle",
        "Binoculars",
        "Birdcage",
        "Biscuit",
        "Blanket",
        "Blender",
        "Book",
        "Boomerang",
        "Boot",
        "Bottle",
        "Bow_tie",
        "Bowl",
        "Box",
        "Bracelet",
        "Bread",
        "Brick",
        "Briefcase",
        "Broom",
        "Bucket",
        "Button",
        "Calculator",
        "Camera",
        "Candle",
        "Canoe",
        "Cap",
        "Car",
        "Cardboard",
        "Carpet",
        "Carrot",
        "Chair",
        "Chalk",
        "Cheese",
        "Chess",
        "Clock",
        "Cloud",
        "Coat",
        "Coconut",
        "Coffee",
        "Comb",
        "Compass",
        "Computer_mouse",
        "Cookie",
        "Cork",
        "Cotton",
        "Crayon",
        "Cup",
        "Desk",
        "Diamond",
        "Dice",
        "Dictionary",
        "Dishwasher",
        "Doll",
        "Door_handle",
        "Doorbell",
        "Drums",
        "Duck",
        "Dustpan",
        "Egg",
        "Elastic_band",
        "Electric_guitar",
        "Elephant",
        "Elevator",
        "Envelope",
        "Eraser",
        "Eye_glasses",
        "Fan_(machine)",
        "Feather",
        "Fence",
        "Fire_extinguisher",
        "Fireplace",
        "Fish_hook",
        "Flag",
        "Flashlight",
        "Flower_pot",
        "Flute",
        "Football",
        "Fork",
        "Fridge",
        "Frog",
        "Garden_hose",
        "Garlic",
        "Gate",
        "Glove",
        "Glue",
        "Goggles",
        "Goldfish",
        "Golf_club",
        "Grape",
        "Guitar",
        "Hammer",
        "Hammock",
        "Handkerchief",
        "Hanger",
        "Hat",
        "Headphones",
        "Helmet",
        "Hinge",
        "Honey",
        "Hook",
        "Horseshoe",
        "Hourglass",
        "Ice_cream",
        "Ice_skate",
        "Igloo",
        "Ink",
        "Iron_(appliance)",
        "Jacket",
        "Jar",
        "Jeans",
        "Jigsaw_puzzle",
        "Juice",
        "Kettle",
        "Key",
        "Keyboard_(computer)",
        "Kite",
        "Knife",
        "Knot",
        "Ladder",
        "Lamp",
        "Lantern",
        "Laptop",
        "Leaf",
        "Lemon",
        "Light_bulb",
        "Lipstick",
        "Lock",
        "Log",
        "Magnet",
        "Magnifying_glass",
        "Map",
        "Marble_(toy)",
        "Mask",
        "Match",
        "Mattress",
        "Microphone",
        "Microwave_oven",
        "Milk",
        "Mirror",
        "Mitten",
        "Money",
        "Mop",
        "Motorcycle",
        "Mouse_trap",
        "Mug",
        "Mushroom",
        "Nail_(fastener)",
        "Necklace",
        "Needle",
        "Net",
        "Newspaper",
        "Notebook",
        "Oar",
        "Onion",
        "Orange_(fruit)",
        "Oven",
        "Paint_brush",
        "Pan",
        "Paper",
        "Paper_clip",
        "Parachute",
        "Passport",
        "Peach",
        "Peanut",
        "Pear",
        "Pen",
        "Pencil",
        "Perfume",
        "Phone",
        "Piano",
        "Pickaxe",
        "Picture_frame",
        "Pie",
        "Pillow",
        "Pizza",
        "Plate",
        "Playing_card",
        "Plug",
        "Pocket_watch",
        "Potato",
        "Pottery",
        "Purse",
        "Radio",
        "Raincoat",
        "Rake",
        "Razor",
        "Refrigerator",
        "Remote_control",
        "Ring_(jewellery)",
        "Robot",
        "Rock",
        "Rocket",
        "Rope",
        "Rubber_band",
        "Rubber_duck",
        "Rug",
        "Ruler",
        "Saddle",
        "Safety_pin",
        "Salt_shaker",
        "Sandals",
        "Sandwich",
        "Saw",
        "Scarf",
        "Scissors",
        "Screw",
        "Seat_belt",
        "Shampoo",
        "Shield",
        "Shirt",
        "Shoe",
        "Shoelace",
        "Shovel",
        "Shower",
        "Sink",
        "Skateboard",
        "Ski",
        "Skirt",
        "Sled",
        "Slipper",
        "Smartphone",
        "Soap",
        "Sock",
        "Sofa",
        "Soup",
        "Spade",
        "Spatula",
        "Spectacles",
        "Sponge",
        "Spoon",
        "Stairs",
        "Stamp",
        "Stapler",
        "Starfish",
        "Steering_wheel",
        "Stethoscope",
        "Stool",
        "Stopwatch",
        "Stove",
        "Straw",
        "Strawberry",
        "Street_light",
        "Suitcase",
        "Sun",
        "Sunglasses",
        "Sunscreen",
        "Sweater",
        "Swing",
        "Sword",
        "Table",
        "Tablet_computer",
        "Tape",
        "Tea",
        "Teapot",
        "Teddy_bear",
        "Telephone",
        "Telescope",
        "Television",
        "Tennis_racket",
        "Tent",
        "Thermometer",
        "Thimble",
        "Ticket",
        "Tie",
        "Tiger",
        "Tile",
        "Toaster",
        "Toilet",
        "Toilet_paper",
        "Tomato",
        "Toothbrush",
        "Toothpaste",
        "Torch",
        "Towel",
        "Toy",
        "Tractor",
        "Traffic_light",
        "Train",
        "Trash_can",
        "Tree",
        "Triangle_(instrument)",
        "Trousers",
        "Truck",
        "Trumpet",
        "Typewriter",
        "Tyre",
        "Umbrella",
        "Underwear",
        "Uniform",
        "Vacuum_cleaner",
        "Van",
        "Vase",
        "Vegetable",
        "Violin",
        "Wagon",
        "Wallet",
        "Wall",
        "Watch",
        "Water_bottle",
        "Watermelon",
        "Wheel",
        "Wheelbarrow",
        "Whistle",
        "Window",
        "Wire",
        "Wool",
        "Wrench",
        "Xylophone",
        "Yacht",
        "Yo-yo",
        "Yogurt",
        "Zebra",
        "Zipper",
        "Zoo",
      ];

      const targetTopics = [
        "Abraham_Lincoln",
        "Absolute_zero",
        "Abstract_expressionism",
        "Acid_rain",
        "Acupuncture",
        "Age_of_Enlightenment",
        "Agriculture",
        "Alchemy",
        "Alexander_the_Great",
        "Algebra",
        "Amazon_rainforest",
        "American_Civil_War",
        "Anarchism",
        "Ancient_Egypt",
        "Ancient_Greece",
        "Antibiotic",
        "Apartheid",
        "Apollo_11",
        "Archaeology",
        "Architecture",
        "Artificial_intelligence",
        "Asteroid_belt",
        "Atlantis",
        "Atmosphere_of_Earth",
        "Atomic_bomb",
        "Aztec_Empire",
        "Bacteria",
        "Baroque",
        "Baseball",
        "Basketball",
        "Battle_of_Waterloo",
        "Bees",
        "Berlin_Wall",
        "Big_Bang",
        "Biodiversity",
        "Bitcoin",
        "Black_Death",
        "Black_hole",
        "Blood",
        "Buddhism",
        "Byzantine_Empire",
        "Capitalism",
        "Carbon_dioxide",
        "Cathedral",
        "Cell_(biology)",
        "Charles_Darwin",
        "Chernobyl_disaster",
        "Chess",
        "China",
        "Chocolate",
        "Christianity",
        "Circulatory_system",
        "Climate_change",
        "Cold_War",
        "Colosseum",
        "Communism",
        "Computer",
        "Consciousness",
        "Constitution_of_the_United_States",
        "Coral_reef",
        "Crusades",
        "Cryptography",
        "Cubism",
        "D-Day",
        "Da_Vinci_Code",
        "Dark_matter",
        "Declaration_of_Independence",
        "Democracy",
        "Dinosaur",
        "DNA",
        "Doppler_effect",
        "Earth",
        "Earthquake",
        "Easter_Island",
        "Economics",
        "Albert_Einstein",
        "Electricity",
        "Electromagnetism",
        "Elizabeth_I",
        "Energy",
        "English_language",
        "Entropy",
        "Environmentalism",
        "Evolution",
        "Existentialism",
        "Fascism",
        "Feminism",
        "Feudalism",
        "Fibonacci_number",
        "Film_noir",
        "First_Amendment_to_the_United_States_Constitution",
        "Fission",
        "Football",
        "Fractal",
        "French_Revolution",
        "Sigmund_Freud",
        "Fungi",
        "Game_theory",
        "Mahatma_Gandhi",
        "Genetic_engineering",
        "Genghis_Khan",
        "Geography",
        "Geology",
        "Geometry",
        "Global_warming",
        "God",
        "Gold",
        "Golden_ratio",
        "Gravity",
        "Great_Barrier_Reef",
        "Great_Depression",
        "Great_Wall_of_China",
        "Greek_mythology",
        "Greenhouse_effect",
        "Hamlet",
        "Harry_Potter",
        "Heart",
        "Heliocentrism",
        "Hieroglyph",
        "Hinduism",
        "Hiroshima",
        "History_of_the_Internet",
        "Adolf_Hitler",
        "Holocaust",
        "Holy_Roman_Empire",
        "Human_brain",
        "Human_rights",
        "Hydrogen",
        "Ice_Age",
        "Immune_system",
        "Impressionism",
        "Inca_Empire",
        "India",
        "Industrial_Revolution",
        "Influenza",
        "Information_Age",
        "Internet",
        "Islam",
        "Jazz",
        "Jesus",
        "Julius_Caesar",
        "Jupiter",
        "Kangchenjunga",
        "Karl_Marx",
        "Martin_Luther_King_Jr.",
        "Knights_Templar",
        "Language",
        "Laser",
        "Law",
        "Leonardo_da_Vinci",
        "Liberalism",
        "Light",
        "Literature",
        "Logic",
        "Louis_XIV",
        "Machine_learning",
        "Magna_Carta",
        "Magnetism",
        "Mammal",
        "Mandela_Effect",
        "Manhattan_Project",
        "Mars",
        "Mathematics",
        "Maya_civilization",
        "Medicine",
        "Medieval_period",
        "Meme",
        "Mental_disorder",
        "Mesopotamia",
        "Metallurgy",
        "Metaphysics",
        "Meteorology",
        "Microscope",
        "Middle_Ages",
        "Milky_Way",
        "Mind",
        "Mona_Lisa",
        "Monarchy",
        "Money",
        "Moon_landing",
        "Music",
        "Mythology",
        "Nanotechnology",
        "Napoleon",
        "Natural_selection",
        "Nazi_Germany",
        "Neanderthal",
        "Nelson_Mandela",
        "Neolithic_Revolution",
        "Isaac_Newton",
        "Nihilism",
        "Ninja",
        "Nobel_Prize",
        "North_Korea",
        "Nuclear_power",
        "Nuclear_weapon",
        "Ocean",
        "Oil_spill",
        "Olympics",
        "Opera",
        "Optics",
        "Organic_chemistry",
        "Origami",
        "Oxygen",
        "Ozone_layer",
        "Painting",
        "Paleontology",
        "Pandemic",
        "Paper",
        "Paradox",
        "Paris",
        "Particle_physics",
        "Peace",
        "Periodic_table",
        "Philosophy",
        "Photography",
        "Photosynthesis",
        "Physics",
        "Pi",
        "Pablo_Picasso",
        "Piracy",
        "Plato",
        "Plate_tectonics",
        "Poetry",
        "Politics",
        "Pollution",
        "Pompeii",
        "Pop_art",
        "Postmodernism",
        "Printing_press",
        "Probability",
        "Psychology",
        "Pyramid",
        "Quantum_mechanics",
        "Queen_Victoria",
        "Radar",
        "Radio",
        "Rail_transport",
        "Rainbow",
        "Religion",
        "Renaissance",
        "Renewable_energy",
        "Reproduction",
        "Republicanism",
        "Roman_Empire",
        "Romanticism",
        "Rome",
        "Rosetta_Stone",
        "Russian_Revolution",
        "Samurai",
        "Satellite",
        "Saturn",
        "Science_fiction",
        "Scientific_method",
        "Sculpture",
        "Second_Law_of_Thermodynamics",
        "William_Shakespeare",
        "Shark",
        "Silk_Road",
        "Slavery",
        "Socialism",
        "Sociology",
        "Solar_System",
        "Soul",
        "Sound",
        "Soviet_Union",
        "Space_exploration",
        "Space_Race",
        "Special_relativity",
        "Species",
        "Speed_of_light",
        "Star_Wars",
        "Steam_engine",
        "Stock_market",
        "Stonehenge",
        "Submarine",
        "Sun",
        "Supernova",
        "Surrealism",
        "Sustainability",
        "Symphony_No._9_(Beethoven)",
        "Taoism",
        "Taxonomy_(biology)",
        "Technology",
        "Telecommunication",
        "Television",
        "Terrorism",
        "The_Beatles",
        "The_Great_Gatsby",
        "The_Matrix",
        "Theory_of_everything",
        "Theory_of_relativity",
        "Thermodynamics",
        "Time",
        "Time_travel",
        "Titanic",
        "Totalitarianism",
        "Tourism",
        "Trade",
        "Tragedy",
        "Transistor",
        "Treaty_of_Versailles",
        "Trigonometry",
        "Tsunami",
        "Alan_Turing",
        "United_Nations",
        "Universe",
        "University",
        "Urbanization",
        "Utilitarianism",
        "Vaccine",
        "Vegetarianism",
        "Venus",
        "Video_game",
        "Viking",
        "Virus",
        "Volcano",
        "Voting",
        "War",
        "Water",
        "Weather",
        "Web_browser",
        "Wheel",
        "Wikipedia",
        "Wind_power",
        "Wine",
        "World_War_I",
        "World_War_II",
        "World_Wide_Web",
        "Writing",
        "X-ray",
        "Yoga",
        "YouTube",
        "Zero",
        "Zombie",
        "Zoology",
      ];

      // --- STATE ---
      let gameState = {
        active: false,
        startPage: "",
        targetPage: "",
        currentPage: "",
        clicks: 0,
        startTime: 0,
        timerInterval: null,
        path: [],
      };

      // --- DOM ELEMENTS ---
      const els = {
        menu: document.getElementById("menuScreen"),
        game: document.getElementById("gameScreen"),
        content: document.getElementById("wikiContent"),
        breadcrumbs: document.getElementById("breadcrumbs"),
        targetDisplay: document.getElementById("targetDisplay"),
        targetDesc: document.getElementById("targetDesc"),
        clicks: document.getElementById("clickCount"),
        timer: document.getElementById("timerDisplay"),
        winModal: document.getElementById("winModal"),
        startBtn: document.getElementById("startBtn"),
        giveUpBtn: document.getElementById("giveUpBtn"),
        submitBtn: document.getElementById("submitScoreBtn"),
        playAgainBtn: document.getElementById("playAgainBtn"),
      };

      // --- API HELPERS ---

      // Fetch Wiki Content using MediaWiki API (CORS friendly)
      async function fetchWikiContent(title) {
        const endpoint = `https://en.wikipedia.org/w/api.php?action=parse&page=${title}&prop=text&format=json&origin=*&redirects=1`;
        try {
          const response = await fetch(endpoint);
          const data = await response.json();
          if (data.error) throw new Error(data.error.info);
          return {
            title: data.parse.title,
            html: data.parse.text["*"],
          };
        } catch (e) {
          console.error("Wiki Fetch Error", e);
          return null;
        }
      }

      // Fetch Summary for Target Description
      async function fetchWikiSummary(title) {
        const endpoint = `https://en.wikipedia.org/api/rest_v1/page/summary/${title}`;
        try {
          const response = await fetch(endpoint);
          return await response.json();
        } catch (e) {
          return { description: "Target Page" };
        }
      }

      // --- GAME LOGIC ---

      async function startGame() {
        // Reset State
        gameState.clicks = 0;
        gameState.path = [];
        gameState.active = true;

        // Pick Randoms
        gameState.startPage =
          startingPoints[Math.floor(Math.random() * startingPoints.length)];
        gameState.targetPage =
          targetTopics[Math.floor(Math.random() * targetTopics.length)];

        // UI Setup
        els.menu.classList.add("hidden");
        els.game.classList.remove("hidden");
        els.winModal.style.display = "none";
        els.clicks.textContent = "0";
        els.timer.textContent = "0:00";

        // Load Target Info
        els.targetDisplay.textContent = gameState.targetPage.replace(/_/g, " ");
        fetchWikiSummary(gameState.targetPage).then((data) => {
          els.targetDesc.textContent =
            data.description || "A Wikipedia Article";
        });

        // Start Timer
        gameState.startTime = Date.now();
        if (gameState.timerInterval) clearInterval(gameState.timerInterval);
        gameState.timerInterval = setInterval(updateTimer, 1000);

        // Load First Page
        await loadPage(gameState.startPage);
      }

      async function loadPage(title) {
        els.content.innerHTML = `<div class="loading-spinner">Traveling to ${title.replace(
          /_/g,
          " "
        )}...</div>`;

        const data = await fetchWikiContent(title);

        if (!data) {
          els.content.innerHTML = `<div class="error">Failed to load page. <button onclick="loadPage('${title}')">Try Again</button></div>`;
          return;
        }

        // Update State
        gameState.currentPage = data.title; // Use canonical title from API
        gameState.path.push(data.title);

        // Update UI
        updateBreadcrumbs();
        els.content.innerHTML = data.html;
        window.scrollTo(0, 0);

        // Process Links
        processLinks();

        // Check Win Condition
        // We compare simplified strings to avoid casing/underscore mismatch issues
        const cleanCurrent = data.title.toLowerCase().trim();
        const cleanTarget = gameState.targetPage
          .replace(/_/g, " ")
          .toLowerCase()
          .trim();

        if (cleanCurrent === cleanTarget) {
          handleWin();
        }
      }

      function processLinks() {
        const links = els.content.querySelectorAll("a");
        links.forEach((link) => {
          const href = link.getAttribute("href");

          // Logic: Must be internal Wiki link, not file, not special page
          if (href && href.startsWith("/wiki/") && !href.includes(":")) {
            link.onclick = (e) => {
              e.preventDefault();
              if (!gameState.active) return;

              const nextTitle = href.split("/wiki/")[1];
              gameState.clicks++;
              els.clicks.textContent = gameState.clicks;
              loadPage(nextTitle);
            };
          } else {
            // Disable external links or files to keep user in "Game Mode"
            link.removeAttribute("href");
            link.style.color = "#999";
            link.style.cursor = "default";
            link.style.textDecoration = "none";
          }
        });
      }

      function updateBreadcrumbs() {
        // Show last 4 items only if path is long
        const showPath =
          gameState.path.length > 4
            ? ["...", ...gameState.path.slice(-4)]
            : gameState.path;

        els.breadcrumbs.innerHTML = showPath
          .map(
            (item) => `<span class="crumb">${item.replace(/_/g, " ")}</span>`
          )
          .join("");
      }

      function updateTimer() {
        const delta = Math.floor((Date.now() - gameState.startTime) / 1000);
        const mins = Math.floor(delta / 60);
        const secs = delta % 60;
        els.timer.textContent = `${mins}:${secs.toString().padStart(2, "0")}`;
      }

      function handleWin() {
        gameState.active = false;
        clearInterval(gameState.timerInterval);

        const timeVal = els.timer.textContent;

        document.getElementById("winTargetName").textContent =
          gameState.targetPage.replace(/_/g, " ");
        document.getElementById("winClicks").textContent = gameState.clicks;
        document.getElementById("winTime").textContent = timeVal;

        els.winModal.style.display = "flex";

        // Save Local Score
        saveLocalScore(gameState.clicks, timeVal);
      }

      // --- LEADERBOARD & DATA ---

      function saveLocalScore(clicks, time) {
        const history = JSON.parse(
          localStorage.getItem("wikiSpeedRun_history") || "[]"
        );
        history.push({
          date: new Date().toLocaleDateString(),
          clicks: clicks,
          time: time,
          route: `${gameState.startPage} → ${gameState.targetPage}`,
        });
        localStorage.setItem("wikiSpeedRun_history", JSON.stringify(history));
        renderLocalStats();
      }

      function renderLocalStats() {
        const history = JSON.parse(
          localStorage.getItem("wikiSpeedRun_history") || "[]"
        );
        if (history.length === 0) return;

        const best = history.sort((a, b) => a.clicks - b.clicks)[0]; // Sort by clicks
        document.getElementById("localStats").innerHTML = `
          <strong>Best Run:</strong> ${best.clicks} clicks in ${best.time} <br>
          <small>(${best.route})</small>
        `;
      }

      async function submitGlobalScore() {
        const name = document.getElementById("playerName").value || "Anonymous";
        const btn = document.getElementById("submitScoreBtn");

        // 1. Change button state to loading
        const originalText = btn.textContent;
        btn.textContent = "Submitting...";
        btn.disabled = true;
        btn.style.opacity = "0.7";

        try {
          const timeInSeconds = Math.floor(
            (Date.now() - gameState.startTime) / 1000
          );

          // 2. Send data (using no-cors as before)
          await fetch(APPS_SCRIPT_URL, {
            method: "POST",
            mode: "no-cors",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              action: "addScore",
              playerName: name,
              clicks: gameState.clicks,
              time: timeInSeconds,
              route: `${gameState.startPage} → ${gameState.targetPage}`,
              timestamp: Date.now(),
            }),
          });

          // 3. SUCCESS ANIMATION (No Alert!)
          btn.textContent = "Score Saved!";
          btn.style.backgroundColor = "#27ae60"; // Green color
          btn.style.borderColor = "#27ae60";
          btn.style.opacity = "1";

          // Refresh the leaderboard in the background
          loadGlobalLeaderboard();
        } catch (e) {
          console.error(e);
          // Error state
          btn.textContent = "Error (Saved Locally)";
          btn.style.backgroundColor = "#e74c3c"; // Red color
        }
      }

      async function loadGlobalLeaderboard() {
        const list = document.getElementById("leaderboardList");
        if (
          APPS_SCRIPT_URL.includes("script.google.com") &&
          !APPS_SCRIPT_URL.includes("YOUR_URL")
        ) {
          try {
            const res = await fetch(`${APPS_SCRIPT_URL}?action=getScores`);
            const data = await res.json();

            // Sort by clicks then time
            const scores = data.records
              .sort((a, b) => {
                if (a.clicks !== b.clicks) return a.clicks - b.clicks;
                return a.time - b.time;
              })
              .slice(0, 5); // Top 5

            list.innerHTML = scores
              .map(
                (s, i) => `
              <div class="lb-row">
                <span>#${i + 1} ${s.playerName}</span>
                <span>${s.clicks} clicks (${Math.floor(s.time / 60)}:${(
                  s.time % 60
                )
                  .toString()
                  .padStart(2, "0")})</span>
              </div>
            `
              )
              .join("");
          } catch (e) {
            list.innerHTML = "<small>Leaderboard unavailable</small>";
          }
        } else {
          list.innerHTML = "<small>Leaderboard not configured.</small>";
        }
      }

      // --- EVENTS ---
      els.startBtn.addEventListener("click", startGame);

      els.giveUpBtn.addEventListener("click", () => {
        if (confirm("Are you sure you want to quit?")) {
          location.reload();
        }
      });

      els.playAgainBtn.addEventListener("click", () => {
        location.reload();
      });

      els.submitBtn.addEventListener("click", submitGlobalScore);

      // --- INIT ---
      renderLocalStats();
      loadGlobalLeaderboard();
    </script>
  </body>
</html>
